<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>소셜로그인 테스트</title>
</head>
<body>
<h1>OAuth2 소셜로그인 테스트</h1>
<a href="/oauth2/authorization/kakao">카카오 로그인</a><br>
<button id="testApiBtn">API 호출</button>

<script>

// JWT 디코딩 함수
function parseJwt(token) {
const base64Url = token.split('.')[1];
const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
}).join(''));

return JSON.parse(jsonPayload);
}

// 버튼 클릭 이벤트
document.getElementById('testApiBtn').addEventListener('click', function() {
const accessToken = document.cookie.split('; ').find(row => row.startsWith('accessToken=')).split('=')[1];

if (!accessToken) {
alert("Access Token이 없습니다. 로그인하세요.");
return;
}

// JWT에서 userId 추출
const decodedToken = parseJwt(accessToken);

console.log(decodedToken)
const userId = decodedToken.sub;

    console.log("유저 아이디는 뭘까요?", userId)

// API 호출 (JWT를 Authorization 헤더에 추가)
fetch(`/api/user/fol/${userId}`, {
method: 'GET',
headers: {
'Authorization': 'Bearer ' + accessToken
}
})
.then(response => response.json())
.then(data => {
console.log("API 응답:", data);
alert("API 호출 성공: " + JSON.stringify(data));
})
.catch(error => {
console.error("API 호출 오류:", error);
alert("API 호출 실패");
});
});
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>소셜로그인 테스트</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>OAuth2 소셜로그인 테스트</h1>-->
<!--<a href="/oauth2/authorization/kakao">카카오 로그인</a><br>-->

<!--<button id="testApiBtn">API 요청 테스트</button>-->

<!--<script>-->
<!--    // 로그인 후, 백엔드에서 JWT 토큰을 Set-Cookie로 설정한다면, 아래 코드를 통해 쿠키에서 JWT를 가져와 LocalStorage에 저장-->
<!--    document.getElementById('testApiBtn').addEventListener('click', function() {-->
<!--        // 쿠키에서 accessToken 추출-->
<!--        const cookies = document.cookie.split(';');-->
<!--        let accessToken = null;-->

<!--        for (let i = 0; i < cookies.length; i++) {-->
<!--            const cookie = cookies[i].trim();-->
<!--            if (cookie.startsWith('accessToken=')) {-->
<!--                accessToken = cookie.split('=')[1];-->
<!--                break;-->
<!--            }-->
<!--        }-->

<!--        if (!accessToken) {-->
<!--            alert("Access Token이 없습니다. 로그인하세요.");-->
<!--            return;-->
<!--        }-->

<!--        console.log("액세스 토큰이 있긴 함? ", accessToken)-->
<!--        console.log("쿠키는 있음?? ", cookies)-->

<!--        // API 호출 (JWT를 Authorization 헤더에 추가)-->
<!--        fetch('/api/user/fol/1', {-->
<!--            method: 'GET',-->
<!--            headers: {-->
<!--                'Authorization': 'Bearer ' + accessToken-->
<!--            }-->
<!--        })-->
<!--            .then(response => {-->
<!--                if (!response.ok) {-->
<!--                    throw new Error("네트워크 응답이 실패했습니다.");-->
<!--                }-->
<!--                return response.json();-->
<!--            })-->
<!--            .then(data => {-->
<!--                console.log("API 응답:", data);-->
<!--                alert("API 호출 성공: " + JSON.stringify(data));-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("API 호출 오류:", error);-->
<!--                alert("API 호출 실패");-->
<!--            });-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->